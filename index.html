<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åå¤å±‹ãƒ»å†¬ä¹‹æ—…</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Yomogi&family=Noto+Sans+TC:wght@400;500;700&swap" rel="stylesheet">

    <style>
        /* è‡ªå®šç¾©æ¨£å¼è¨­å®š */
        :root {
            --bg-paper: #f9f7f2;
            --primary: #769a9e; /* è«è˜­è¿ªç¶  */
            --secondary: #e6a496; /* çŠç‘šç²‰ */
            --accent: #dca856; /* èŠ¥æœ«é»ƒ */
            --text-main: #4a4a4a;
            --text-light: #7a7a7a;
            /* æ¨™ç±¤é¡è‰² */
            --tag-eat: #e67e22;
            --tag-buy: #e74c3c;
            --tag-go: #27ae60;
            --tag-code: #2980b9;
        }

        body {
            /* å„ªå…ˆä½¿ç”¨å¾®è»Ÿæ­£é»‘é«”ã€è˜‹æœå„·ä¸­é»‘ */
            font-family: "Microsoft JhengHei", "PingFang TC", "Heiti TC", "Noto Sans TC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-paper);
            color: var(--text-main);
            /* æ¨¡æ“¬ç´™å¼µç´‹ç† */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            -webkit-font-smoothing: antialiased;
            font-weight: 500;
        }

        h1, h2, h3, .handwriting {
            font-family: 'Yomogi', "Microsoft JhengHei", cursive;
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* æ°´å½©é¢¨æ ¼å¡ç‰‡ */
        .watercolor-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            box-shadow: 2px 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0,0,0,0.02);
            transition: transform 0.2s ease;
            cursor: pointer; /* è®“ä½¿ç”¨è€…çŸ¥é“å¯ä»¥é»æ“Š */
        }
        
        .watercolor-card:active {
            transform: scale(0.98);
        }

        /* æ™‚é–“è»¸ç·šæ¢ */
        .timeline-line::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 14px;
            width: 2px;
            background: #e0e0e0;
            border-radius: 2px;
            z-index: 0;
        }

        /* åº•éƒ¨å°èˆªé¸ä¸­æ…‹ */
        .nav-item.active {
            color: var(--primary);
            font-weight: bold;
        }
        .nav-item.active i {
            background-color: rgba(118, 154, 158, 0.2);
            border-radius: 50%;
            padding: 8px;
            transform: scale(1.1);
        }

        /* å‹¾é¸æ¡†æ¨£å¼ */
        .custom-checkbox:checked + label {
            text-decoration: line-through;
            color: #aaa;
            opacity: 0.7;
        }
        
        /* é é¢åˆ‡æ›å‹•ç•« */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .tab-content.active {
            display: block;
        }
        
        /* å½±éŸ³å¡ç‰‡ç‰¹å®šæ¨£å¼ */
        .yt-icon { color: #FF0000; }
        .ig-icon { 
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Modal å½ˆçª—æ¨£å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            backdrop-filter: blur(3px);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.open {
            display: flex;
        }
        .modal-content {
            background: #fff;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* å°éŠåˆ†ææ¨™ç±¤æ¨£å¼ */
        .guide-tag {
            display: inline-block;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 4px;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        .tag-eat { background-color: var(--tag-eat); }
        .tag-buy { background-color: var(--tag-buy); }
        .tag-go { background-color: var(--tag-go); }
        .tag-code { background-color: var(--tag-code); font-family: monospace; letter-spacing: 1px;}
    </style>
</head>
<body class="pb-24">

    <header class="sticky top-0 z-50 bg-[#f9f7f2]/95 backdrop-blur-md px-4 py-3 shadow-sm border-b border-gray-200/50">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-[#5e8b7e]">Nagoya Trip â„ï¸</h1>
                <p class="text-xs text-gray-500 font-sans tracking-wide">2026.02.09 - 02.13</p>
            </div>
            <div class="text-right text-xs text-gray-600 bg-white/60 p-2 rounded-lg border border-gray-100 font-mono">
                <div>ğŸ›« CI154 07:35</div>
                <div>ğŸ›¬ CI155 12:05</div>
            </div>
        </div>
    </header>

    <section id="plan" class="tab-content active px-4 pt-4">
        <div class="flex overflow-x-auto no-scrollbar gap-3 mb-4 pb-2" id="date-scroll"></div>
        <div id="weather-card-container">
            </div>
        <div id="itinerary-container" class="space-y-6 relative timeline-line mt-4"></div>
        <p class="text-center text-xs text-gray-400 mt-4">âœ¨ é»æ“Šè¡Œç¨‹å¡ç‰‡æŸ¥çœ‹å°éŠæ”»ç•¥ âœ¨</p>
    </section>

    <section id="guide" class="tab-content px-4 pt-4 space-y-6">
        <div class="text-center mb-4">
            <h2 class="text-2xl handwriting text-[#769a9e]">Travel Guide</h2>
            <p class="text-sm text-gray-500">åŸå¸‚çš„è¨˜æ†¶èˆ‡æ•…äº‹</p>
        </div>
        <div id="guide-container" class="space-y-8"></div>
    </section>
    
    <section id="media" class="tab-content px-4 pt-4">
        <div class="text-center mb-6">
            <h2 class="text-2xl handwriting text-[#dca856]">Video Guide</h2>
            <p class="text-sm text-gray-500">æ”¶è—çš„å½±ç‰‡èˆ‡Reels</p>
        </div>
        <div id="media-container" class="space-y-4"></div>
    </section>

    <section id="lists" class="tab-content px-4 pt-4">
        <div class="mb-20">
            <h2 class="text-xl handwriting mb-3 text-[#e6a496]"><i class="fas fa-suitcase-rolling mr-2"></i>Packing List</h2>
            <div class="bg-white p-5 rounded-[20px] shadow-sm relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-[#e6a496]"></div>
                <div id="checklist-container" class="space-y-3"></div>
            </div>
        </div>
    </section>

    <section id="info" class="tab-content px-4 pt-4 space-y-6">
        
        <div>
            <h3 class="text-lg font-bold text-[#769a9e] mb-2"><i class="fas fa-plane-departure mr-2"></i>èˆªç­è³‡è¨Š</h3>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center border-b border-gray-100 pb-3 mb-3">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-gray-700">TPE</div>
                        <div class="text-xs text-gray-400">å°åŒ—æ¡ƒåœ’ T2</div>
                    </div>
                    <div class="flex-1 px-4 text-center">
                        <div class="text-[#dca856] text-sm"><i class="fas fa-plane"></i> CI154</div>
                        <div class="h-[1px] bg-gray-300 w-full my-1"></div>
                        <div class="text-xs text-gray-400">2h 30m</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-gray-700">NGO</div>
                        <div class="text-xs text-gray-400">ä¸­éƒ¨åœ‹éš› T1</div>
                    </div>
                </div>
                <div class="flex justify-between text-sm">
                    <div><span class="text-gray-400">å»ç¨‹ï¼š</span>02/09 07:35</div>
                    <div><span class="text-gray-400">å›ç¨‹ï¼š</span>02/13 12:05 (CI155)</div>
                </div>
            </div>
        </div>

        <div>
            <h3 class="text-lg font-bold text-[#e6a496] mb-2"><i class="fas fa-hotel mr-2"></i>ä½å®¿è³‡è¨Š</h3>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 space-y-3">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-[#f9f7f2] flex items-center justify-center text-[#e6a496] shrink-0">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>
                        <div class="font-bold text-gray-700">ç‰§é‡æ±å…¬åœ’æ—ä½å®¿ (Airbnb)</div>
                        <div class="text-xs text-gray-500 mb-1">02/09 - 02/12 (3æ™š)</div>
                        <a href="https://maps.google.com/?q=ç‰§é‡æ±å…¬åœ’" target="_blank" class="text-xs text-[#769a9e] underline">æŸ¥çœ‹åœ°åœ–</a>
                    </div>
                </div>
                <hr class="border-gray-50">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-[#f9f7f2] flex items-center justify-center text-[#e6a496] shrink-0">
                        <i class="fas fa-hotel"></i>
                    </div>
                    <div>
                        <div class="font-bold text-gray-700">Nagoya JR Gate Tower Hotel</div>
                        <div class="text-xs text-gray-500 mb-1">02/12 - 02/13 (1æ™š)</div>
                        <a href="https://maps.google.com/?q=Nagoya+JR+Gate+Tower+Hotel" target="_blank" class="text-xs text-[#769a9e] underline">æŸ¥çœ‹åœ°åœ–</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="watercolor-card p-4 flex flex-col items-center justify-center gap-2 text-center text-[#5e8b7e]">
                <i class="fas fa-cloud-sun text-3xl"></i>
                <span class="font-bold">å¤©æ°£é å ±</span>
                <span class="text-xs text-gray-400">æ—¥æœ¬æ°£è±¡å»³</span>
            </a>
            <a href="https://vjw-lp.digital.go.jp/en/" target="_blank" class="watercolor-card p-4 flex flex-col items-center justify-center gap-2 text-center text-[#e6a496]">
                <i class="fas fa-qrcode text-3xl"></i>
                <span class="font-bold">VJW å…¥å¢ƒ</span>
                <span class="text-xs text-gray-400">é€šé—œå¿…å‚™</span>
            </a>
        </div>

        <div class="bg-red-50 rounded-xl p-4 border border-red-100 mb-20">
            <h3 class="text-red-800 font-bold mb-2"><i class="fas fa-exclamation-circle mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
            <ul class="text-sm text-red-700 space-y-1">
                <li class="flex justify-between"><span>å ±è­¦ (è­¦å¯Ÿå±€)</span><span class="font-mono font-bold">110</span></li>
                <li class="flex justify-between"><span>ç«è­¦ / æ•‘è­·è»Š</span><span class="font-mono font-bold">119</span></li>
                <li class="mt-2 text-xs border-t border-red-200 pt-2">
                    <div class="font-bold">å°åŒ—é§å¤§é˜ªç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•</div>
                    <div class="font-mono">06-6227-8623</div>
                    <div class="text-[10px] opacity-75">ç·Šæ€¥ï¼š090-8794-4568</div>
                </li>
            </ul>
        </div>
    </section>

    <nav class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-filter backdrop-blur-lg border-t border-gray-200 pb-safe pt-2 px-2 flex justify-between items-center z-50 h-[80px] rounded-t-[20px] shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
        <button onclick="switchTab('plan')" class="nav-item active flex flex-col items-center gap-1 text-gray-400 transition-colors flex-1" id="nav-plan">
            <i class="fas fa-calendar-alt text-lg"></i>
            <span class="text-[10px]">è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('guide')" class="nav-item flex flex-col items-center gap-1 text-gray-400 transition-colors flex-1" id="nav-guide">
            <i class="fas fa-book-open text-lg"></i>
            <span class="text-[10px]">å°è¦½</span>
        </button>
        <button onclick="switchTab('media')" class="nav-item flex flex-col items-center gap-1 text-gray-400 transition-colors flex-1" id="nav-media">
            <i class="fas fa-play-circle text-lg"></i>
            <span class="text-[10px]">å½±éŸ³</span>
        </button>
        <button onclick="switchTab('lists')" class="nav-item flex flex-col items-center gap-1 text-gray-400 transition-colors flex-1" id="nav-lists">
            <i class="fas fa-list-check text-lg"></i>
            <span class="text-[10px]">æ¸…å–®</span>
        </button>
        <button onclick="switchTab('info')" class="nav-item flex flex-col items-center gap-1 text-gray-400 transition-colors flex-1" id="nav-info">
            <i class="fas fa-info-circle text-lg"></i>
            <span class="text-[10px]">è³‡è¨Š</span>
        </button>
    </nav>

    <div id="event-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="relative h-32 bg-[#769a9e] overflow-hidden rounded-t-[20px]">
                <div class="absolute top-0 left-0 w-full h-full bg-black/20 z-10"></div>
                <div class="absolute bottom-4 left-4 z-20 text-white">
                    <div class="text-xs opacity-80 mb-1" id="modal-time">10:00 - 12:00</div>
                    <h3 class="text-2xl font-bold" id="modal-title">æ™¯é»æ¨™é¡Œ</h3>
                </div>
                <button onclick="closeModal()" class="absolute top-3 right-3 z-30 w-8 h-8 bg-white/30 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/50 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-5">
                <div id="modal-analysis" class="mb-4">
                    <div class="flex flex-wrap gap-2 mb-3" id="modal-tags"></div>
                    <div class="bg-[#f9f7f2] p-3 rounded-lg text-sm text-gray-600 leading-relaxed border-l-4 border-[#dca856]">
                        <span class="font-bold block text-[#dca856] mb-1"><i class="fas fa-lightbulb mr-1"></i>å°éŠç­†è¨˜ï¼š</span>
                        <span id="modal-desc"></span>
                    </div>
                </div>
                
                <a id="modal-map-btn" href="#" target="_blank" class="w-full bg-[#5e8b7e] text-white py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-[#4a7266] transition-colors shadow-md">
                    <i class="fas fa-map-marked-alt"></i> é–‹å•Ÿ Google Maps å°èˆª
                </a>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™å€ - æ“´å……å°éŠåˆ†æè³‡æ–™
        // locations: ç”¨æ–¼æ°£è±¡ API (lat, lon)
        const locationCoords = {
            "Nagoya": { lat: 35.1815, lon: 136.9066 },
            "Tokoname": { lat: 34.8893, lon: 136.8346 },
            "Inuyama": { lat: 35.3883, lon: 136.9396 },
            "Shirakawa": { lat: 36.2566, lon: 136.9043 }, // ç™½å·é„‰
            "Takayama": { lat: 36.1408, lon: 137.2523 }
        };

        const itineraryData = [
            {
                date: "2/9",
                day: "é€±ä¸€",
                hotel: "ç‰§é‡æ±å…¬åœ’æ—ä½å®¿",
                locationKey: "Tokoname", // ç•¶æ—¥ä¸»è¦å¤©æ°£åƒè€ƒé»
                outfit: "æ´‹è”¥å¼ç©¿æ­ã€‚æ©Ÿå ´èˆ‡é›»è»Šæš–æ°£å¼·ï¼Œå¤–æ­ä¿æš–å¤§è¡£æ–¹ä¾¿ç©¿è„«ã€‚",
                events: [
                    { time: "05:00", end: "05:30", title: "å‰å¾€æ¡ƒåœ’æ©Ÿå ´", icon: "fa-car", important: true },
                    { time: "07:35", end: "11:05", title: "TPE âœˆï¸ NGO (CI154)", icon: "fa-plane", desc: "å…¥å¢ƒå¾Œè¨˜å¾—å…ˆé–‹é€š eSIM", guide: "æ©Ÿå ´å‡ºé—œé æŠ“ 40-60 åˆ†é˜ã€‚åéµé›»è»Šè»Šç¥¨å¯æ–¼è‡ªå‹•å”®ç¥¨æ©Ÿè³¼è²·ã€‚" },
                    { time: "12:00", end: "12:20", title: "ç§»å‹•ï¼šæ©Ÿå ´ â†’ å¸¸æ»‘", icon: "fa-train", important: true, guide: "æ­ä¹˜åéµå¸¸æ»‘ç·šï¼Œåƒ…éœ€2ç«™ã€‚" },
                    { 
                        time: "12:20", end: "14:00", title: "å¸¸æ»‘æ•£ç­–", icon: "fa-cat", location: "å¸¸æ»‘è€è¡—",
                        guide: "é™¶ç“·ä¹‹éƒ½ã€‚æ²¿è‘—ã€Œé™¶å™¨æ•£æ­¥é“ã€èµ°ï¼Œå¿…æ‹å·¨å¤§æ‹›è²¡è²“ Tokonyanã€‚",
                        tags: [{text: "å¿…åƒï¼šçƒ¤åœ°ç“œ", type: "eat"}, {text: "å¿…æ‹ï¼šæ‹›è²¡è²“", type: "go"}]
                    },
                    { time: "14:00", end: "15:00", title: "ç§»å‹•ï¼šåå¤å±‹ç«™ â†’ ä½å®¿", icon: "fa-suitcase", important: true },
                    { 
                        time: "15:40", end: "17:30", title: "ç†±ç”°ç¥å®®", icon: "fa-torii-gate", location: "ç†±ç”°ç¥å®®",
                        guide: "æ—¥æœ¬ä¸‰å¤§ç¥å®®ä¹‹ä¸€ã€‚å»ºè­°åœ¨æ¨¹æ—ä¸­æ·±å‘¼å¸æ„Ÿå—èŠ¬å¤šç²¾ã€‚",
                        tags: [{text: "å¿…åƒï¼šå®®ãã—ã‚ã‚“(å¯¬éºµ)", type: "eat"}, {text: "å¿…çœ‹ï¼šä¿¡é•·ç‰†", type: "go"}]
                    },
                    { 
                        time: "18:00", end: "21:30", title: "è“¬èŠè»’ é°»é­šé£¯", icon: "fa-utensils", location: "è“¬èŠè»’ æ¾å‚å±‹åº—",
                        guide: "åå¤å±‹æœ€çŸ¥åçš„é°»é­šé£¯ä¸‰åƒã€‚é€šå¸¸éœ€æ’éšŠï¼Œå»ºè­°å…ˆå»æŠ½æ•´ç†åˆ¸å†å»é€›è¡—ã€‚",
                        tags: [{text: "å¿…åƒï¼šé°»é­šé£¯ä¸‰åƒ", type: "eat"}, {text: "é ç´„ï¼šç¾å ´æŠ½åˆ¸", type: "code"}]
                    },
                    { time: "21:30", end: "22:00", title: "è¿”å›ä½å®¿", icon: "fa-bed" }
                ]
            },
            {
                date: "2/10",
                day: "é€±äºŒ",
                hotel: "ç‰§é‡æ±å…¬åœ’æ—ä½å®¿",
                locationKey: "Inuyama",
                outfit: "â˜…å’Œæœæ—¥ï¼šå…§ç©¿Vé ˜æˆ–ä½é ˜ç™¼ç†±è¡£ï¼ˆå‹¿éœ²é ˜å£ï¼‰ï¼Œè²¼æš–æš–åŒ…ã€‚",
                events: [
                    { 
                        time: "08:00", end: "08:45", title: "Tsubame Bread & Milk", icon: "fa-bread-slice", location: "Tsubame Bread & Milk",
                        guide: "ç¶²ç¾é¢¨æ—©é¤åº—ï¼Œæ‹›ç‰Œæ˜¯é®®å¥¶æ²¹åå¸èˆ‡éœœæ·‡æ·‹ã€‚",
                        tags: [{text: "å¿…åƒï¼šåšç‰‡åå¸", type: "eat"}]
                    },
                    { time: "09:45", end: "10:10", title: "ç§»å‹•ï¼šå‰å¾€11PhotoStudio", icon: "fa-bus", important: true },
                    { 
                        time: "10:10", end: "12:30", title: "11PhotoStudio å’Œæœæ›è£", icon: "fa-user-tie", location: "11PhotoStudio åå¤å±‹",
                        guide: "è¨˜å¾—é¸æ¯”è¼ƒé®®è±”çš„é¡è‰²ï¼Œåœ¨çŠ¬å±±åŸæ‹ç…§æœƒæ¯”è¼ƒçªå‡ºã€‚",
                        tags: [{text: "é ç´„ä»£è™Ÿï¼šCHECK_MAIL", type: "code"}]
                    },
                    { 
                        time: "13:00", end: "16:00", title: "çŠ¬å±±åŸ ï¼† åŸä¸‹ç”º", icon: "fa-chess-rook", location: "çŠ¬å±±åŸ",
                        guide: "åœ‹å¯¶äº”åŸã€‚åŸä¸‹ç”ºæœ‰è¨±å¤šå¯æ„›çš„ç³°å­è·Ÿé£›é©’ç‰›æ¡å£½å¸ã€‚ä¸‰å…‰ç¨»è·ç¥ç¤¾æ´—éŒ¢è¨˜å¾—ç”¨å¤–å¹£ï¼",
                        tags: [{text: "å¿…åƒï¼šé£›é©’ç‰›æ¡å£½å¸", type: "eat"}, {text: "å¿…åšï¼šæ´—éŒ¢", type: "go"}]
                    },
                    { 
                        time: "18:30", end: "20:00", title: "æ¦®å•†åœˆæ™šé¤", icon: "fa-utensils", location: "æ¦®å•†åœˆ",
                        guide: "æ™šé¤é¸æ“‡å¤šï¼Œå¾å±…é…’å±‹åˆ°ç™¾è²¨ç¾é£Ÿè¡—éƒ½æœ‰ã€‚å¯é †é“å»å”å‰è¨¶å¾·æ¡è²·ã€‚",
                        tags: [{text: "å¿…é€›ï¼šå”å‰è¨¶å¾·", type: "buy"}]
                    },
                    { 
                        time: "20:00", end: "21:00", title: "ä¸­éƒ¨é›»åŠ›å¡” å¤œæ™¯", icon: "fa-tower-observation", location: "ä¸­éƒ¨é›»åŠ› MIRAI TOWER",
                        guide: "ç¶ æ´²21çš„æ°´ä¹‹å®‡å®™èˆ¹æ™šä¸Šé»ç‡ˆå¾ˆç¾ï¼Œæ˜¯å…è²»çš„å¤œæ™¯é»ã€‚",
                        tags: [{text: "å¿…æ‹ï¼šæ°´ä¹‹å®‡å®™èˆ¹", type: "go"}]
                    }
                ]
            },
            {
                date: "2/11",
                day: "é€±ä¸‰",
                hotel: "ç‰§é‡æ±å…¬åœ’æ—ä½å®¿",
                locationKey: "Shirakawa",
                outfit: "âš ï¸ æ¥µå¯’æ³¨æ„ï¼ç¾½çµ¨å¤–å¥—ã€æ¯›å¸½ã€æ‰‹å¥—ã€é˜²æ»‘é˜²æ°´é‹ã€‚",
                events: [
                    { time: "08:00", end: "10:10", title: "ç§»å‹•ï¼šå‰å¾€ç™½å·é„‰", icon: "fa-bus", important: true, guide: "é•·é€”å·´å£«ï¼Œå»ºè­°å…ˆä¸Šå»æ‰€ã€‚è»Šä¸Šå¯ä»¥è£œçœ ã€‚" },
                    { 
                        time: "10:10", end: "11:50", title: "ç™½å·é„‰åˆæŒæ‘", icon: "fa-snowflake", location: "ç™½å·é„‰åˆæŒæ‘",
                        guide: "ç«¥è©±ä¸–ç•Œã€‚å¯ä»¥å»åƒè§€å’Œç”°å®¶æˆ–ç¥ç”°å®¶ï¼ˆéœ€é–€ç¥¨ï¼‰ã€‚",
                        tags: [{text: "å¿…åƒï¼šäº”å¹³é¤…", type: "eat"}, {text: "å¿…åƒï¼šé£›é©’ç‰›ä¸²ç‡’", type: "eat"}]
                    },
                    { 
                        time: "14:30", end: "15:40", title: "é£›é©’é«˜å±±è€è¡—", icon: "fa-store", location: "é£›é©’é«˜å±±è€è¡—",
                        guide: "ä¸‰ç”ºé€šå¤è‰²å¤é¦™ã€‚å‘³å™Œè·Ÿæ¸…é…’æ˜¯åç”¢ã€‚",
                        tags: [{text: "å¿…è²·ï¼šå‘³å™Œ", type: "buy"}, {text: "å¿…åƒï¼šç‰›è‚‰åŒ…", type: "eat"}]
                    },
                    { 
                        time: "18:30", end: "20:00", title: "æµ·è€ã©ã¦é£Ÿå ‚", icon: "fa-utensils", location: "æµ·è€ã©ã¦é£Ÿå ‚ ã‚¨ã‚¹ã‚«åº—",
                        guide: "æ“æœ‰å…¨æ—¥æœ¬æœ€å¤§çš„ç‚¸è¦ï¼ˆ35å…¬åˆ†ï¼‰ï¼å°±åœ¨åå¤å±‹è»Šç«™åœ°ä¸‹è¡—ã€‚",
                        tags: [{text: "å¿…åƒï¼šç‰¹å¤§ç‚¸è¦", type: "eat"}]
                    }
                ]
            },
            {
                date: "2/12",
                day: "é€±å››",
                hotel: "JR Gate Tower Hotel",
                locationKey: "Nagoya",
                outfit: "å¸‚å€é€›è¡—æ—¥ã€‚è¼•ä¾¿é‹ã€‚å®¤å…§æš–æ°£è¶³ï¼Œå¤§è¡£å¯å¯„æ”¾ã€‚",
                events: [
                    { time: "09:00", end: "09:20", title: "é£¯åº—å¯„æ”¾è¡Œæ", icon: "fa-luggage-cart", location: "Nagoya JR Gate Tower Hotel", guide: "Gate Tower åœ°é»æ¥µä½³ï¼Œå¯„æ”¾å®Œç›´æ¥æ­è»Šã€‚" },
                    { 
                        time: "10:00", end: "11:30", title: "åå¤å±‹åŸ", icon: "fa-archway", location: "åå¤å±‹åŸ",
                        guide: "å¿…çœ‹é‡‘ç¢§è¼ç…Œçš„ã€Œæœ¬ä¸¸å¾¡æ®¿ã€ã€‚å¤©å®ˆé–£ç›®å‰æ•´ä¿®ä¸­ç„¡æ³•é€²å…¥ï¼Œä½†å¤–è§€ä»å¯æ‹ç…§ã€‚",
                        tags: [{text: "å¿…çœ‹ï¼šæœ¬ä¸¸å¾¡æ®¿", type: "go"}]
                    },
                    { 
                        time: "14:00", end: "18:00", title: "Gate Tower Mall é€›è¡—", icon: "fa-shopping-bag",
                        guide: "Bic Cameraã€Uniqloã€GUã€è¿ªå£«å°¼å•†åº—ä¸€æ¬¡è²·é½Šã€‚é«˜å³¶å±‹æ¨“ä¸‹æœ‰è¶…å¤šä¼´æ‰‹ç¦®ã€‚",
                        tags: [{text: "å¿…è²·ï¼šè¦ä»™è²", type: "buy"}, {text: "å¿…è²·ï¼šå°å€‰åå¸å¤¾å¿ƒ", type: "buy"}]
                    }
                ]
            },
            {
                date: "2/13",
                day: "é€±äº”",
                hotel: "Home Sweet Home",
                locationKey: "Nagoya",
                outfit: "è¿”å°èˆ’é©ç©¿æ­ã€‚å¯¬é¬†é•·è¤²æˆ–é•·è£™ã€‚",
                events: [
                    { time: "08:00", end: "09:00", title: "åéµ Î¼-SKY â†’ æ©Ÿå ´", icon: "fa-train", important: true },
                    { 
                        time: "09:00", end: "12:05", title: "å ±åˆ°ã€å‡ºå¢ƒã€å…ç¨…åº—", icon: "fa-passport",
                        guide: "åå¤å±‹æ©Ÿå ´4æ¨“æœ‰ã€Œè—å¤©åŸã€å¾ˆå¤šé¤å»³è·Ÿå•†åº—ï¼Œå¦‚æœå¤ªæ—©åˆ°å¯ä»¥å»é€›ã€‚",
                        tags: [{text: "å¿…è²·ï¼šå…ç¨…ç”œé»", type: "buy"}]
                    },
                    { time: "12:05", end: "14:40", title: "NGO âœˆï¸ TPE (CI155)", icon: "fa-plane-departure" }
                ]
            }
        ];

        const guideData = [
            {
                category: "å¤è¹Ÿæ™¯é»å°è¦½",
                color: "text-[#5e8b7e]",
                items: [
                    {
                        title: "å¸¸æ»‘è€è¡—",
                        img: "https://www.aichi-now.jp/upload/spot_images/8c34479e000490b4d45d90956488d011.jpg",
                        desc: "è·é›¢æ©Ÿå ´åƒ…20åˆ†é˜çš„é™¶ç“·ä¹‹éƒ½ã€‚æ¼«æ­¥åœ¨ã€Œé™¶å™¨æ•£æ­¥é“ã€ï¼Œæ¬£è³ç´…ç£šç…™å›ªèˆ‡é»‘è‰²æ¿å£å·¥å» ï¼Œæœ€è‘—åçš„æ˜¯å·¨å¤§çš„ã€Œå®ˆè­·è²“Tokonyanã€æ‹›è²¡è²“ã€‚",
                    },
                    {
                        title: "ç†±ç”°ç¥å®®",
                        img: "https://static.gltjp.com/glt/data/article/21000/20401/20241119_023936_de5ef996_w1920.webp",
                        desc: "æ—¥æœ¬ä¸‰å¤§ç¥å®®ä¹‹ä¸€ï¼Œä¾›å¥‰è‘—è‰è–™åŠã€‚èµ°åœ¨å……æ»¿éˆæ°£çš„æ£®æ—åƒé“ï¼Œåˆ¥å¿˜äº†åœ¨å¢ƒå…§çš„ã€Œå®®ãã—ã‚ã‚“ã€äº«ç”¨åç‰©å¯¬éºµï¼Œä¸¦åƒè§€æ“šèªªæ˜¯ç¹”ç”°ä¿¡é•·å‡ºå¾å‰ç¥ˆé¡˜å‹åˆ©çš„ã€Œä¿¡é•·ç‰†ã€ã€‚",
                    },
                    {
                        title: "çŠ¬å±±åŸ",
                        img: "https://d1grca2t3zpuug.cloudfront.net/2025/12/2025inuyamajo16-870x500-1765244239.webp",
                        desc: "æ—¥æœ¬ç¾å­˜æœ€å¤è€çš„æœ¨é€ å¤©å®ˆï¼Œåœ‹å¯¶äº”åŸä¹‹ä¸€ã€‚ç™»ä¸Šå¤©å®ˆé–£é ‚å±¤ï¼Œå¯ä»¥360åº¦ä¿¯ç°æœ¨æ›¾å·çš„çµ•ç¾æ™¯è‰²ã€‚åŸä¸‹ç”ºä¿æœ‰æ±Ÿæˆ¶æ™‚ä»£é¢¨æƒ…ï¼Œéå¸¸é©åˆç©¿è‘—å’Œæœæ•£æ­¥ã€‚",
                    },
                    {
                        title: "ä¸‰å…‰ç¨»è·ç¥ç¤¾",
                        img: "https://rimage.gnst.jp/livejapan.com/public/article/detail/a/00/01/a0001650/img/basic/a0001650_main.jpg",
                        desc: "ä½æ–¼çŠ¬å±±åŸè…³ä¸‹ï¼Œä»¥ç²‰ç´…è‰²æ„›å¿ƒç¹ªé¦¬èåï¼Œæ˜¯æ±‚è‰¯ç·£çš„è–åœ°ã€‚ç¥ç¤¾å…§é‚„æœ‰ã€ŒéŒ¢æ´—ç¨»è·ã€ï¼Œæ“šèªªç”¨é€™è£¡çš„ç¥æ°´æ´—éçš„éŒ¢æœƒåŠ å€å›ä¾†ï¼Œè¨˜å¾—æº–å‚™å¤–å¹£æˆ–å¤§éˆ”ä¾†æ´—éŒ¢ï¼",
                    },
                    {
                        title: "ä¸­éƒ¨é›»åŠ› MIRAI TOWER",
                        img: "https://www.nagoya-tv-tower.co.jp/wp/wp-content/uploads/2020/07/ph_history-05.jpg",
                        desc: "èˆŠç¨±åå¤å±‹é›»è¦–å¡”ï¼Œæ˜¯æ—¥æœ¬ç¬¬ä¸€åº§é›†ç´„é›»æ³¢å¡”ã€‚å¤œæ™šé»ç‡ˆå¾Œèˆ‡å‰æ–¹çš„ã€Œç¶ æ´²21ã€æ°´ä¹‹å®‡å®™èˆ¹ç›¸äº’è¼æ˜ ï¼Œæ˜¯åå¤å±‹æœ€ç¶“å…¸çš„å¤œæ™¯åœ°æ¨™ã€‚",
                    },
                    {
                        title: "ç™½å·é„‰åˆæŒæ‘",
                        img: "https://d1grca2t3zpuug.cloudfront.net/2024/09/66e26c5a140b9-870x500.webp",
                        desc: "ä¸–ç•Œæ–‡åŒ–éºç”¢ï¼Œå¦‚åŒç«¥è©±èˆ¬çš„æ‘è½ã€‚å†¬å­£æ™‚ç™½é›ªè¦†è“‹åœ¨ã€ŒåˆæŒé€ ã€èŒ…è‰å±‹é ‚ä¸Šï¼Œæ™¯è‰²å¤¢å¹»ã€‚æ‘å…§çš„å’Œç”°å®¶ã€ç¥ç”°å®¶å¯å…¥å…§åƒè§€ï¼Œæ„Ÿå—å…ˆäººçš„ç”Ÿæ´»æ™ºæ…§ã€‚",
                    },
                    {
                        title: "é£›é©’é«˜å±±è€è¡—",
                        img: "https://www.hidatakayama.or.jp/assets/images/concept/img_concept_kv_sp.jpg",
                        desc: "æœ‰ã€Œé£›é©’å°äº¬éƒ½ã€ä¹‹ç¨±ã€‚ä¸‰ç”ºé€šä¿ç•™äº†é»‘è‰²æœ¨é€ çš„å¤å»ºç¯‰ï¼Œé‡€é…’å» ã€å‘³å™Œåº—æ—ç«‹ã€‚å¿…åƒå…¥å£å³åŒ–çš„é£›é©’ç‰›æ¡å£½å¸ä»¥åŠç†±å‘¼å‘¼çš„ç‰›è‚‰åŒ…ã€‚",
                    },
                    {
                        title: "åå¤å±‹åŸ",
                        img: "https://res.klook.com/images/w_1200,h_630,c_fill,q_65/activities/mv6lrp0mrcl0chali7mm/åå¤å±‹åŸ.jpg",
                        desc: "å¾·å·å®¶åº·çš„å±…åŸï¼Œå±‹é ‚ä¸Šçš„é‡‘é¯±é–ƒè€€å¥ªç›®ã€‚ä¿®å¾©å®Œæˆçš„ã€Œæœ¬ä¸¸å¾¡æ®¿ã€å…§éƒ¨é‡‘ç¢§è¼ç…Œï¼Œéšœå£ç•«ç²¾ç¾çµ•å€«ï¼Œå±•ç¾äº†æ­¦å®¶æ–‡åŒ–çš„å¥¢è¯èˆ‡å¨åš´ã€‚",
                    }
                ]
            },
            {
                category: "é€›è¡—æ”»ç•¥",
                color: "text-[#e6a496]",
                items: [
                    {
                        title: "JR Gate Tower / é«˜å³¶å±‹",
                        img: "https://lh3.googleusercontent.com/p/AF1QipN30Xn5aEwFqP5vO7m4x_S3q6zX_5v5n3k4h7z0=s1360-w1360-h1020",
                        desc: "èˆ‡åå¤å±‹è»Šç«™ç›´çµï¼Œæ“æœ‰Bic Cameraã€Uniqloã€GUä»¥åŠå…¨æ—¥æœ¬æœ€å¤§çš„è¿ªå£«å°¼å•†åº—ã€‚é«˜å±¤æ¨“é‚„æœ‰æ™¯è§€æ˜Ÿå·´å…‹èˆ‡å„å¼é¤å»³ï¼Œæ˜¯é›¢é–‹å‰æœ€å¾Œè¡åˆºçš„é¦–é¸ã€‚",
                    },
                    {
                        title: "æ¦®å•†åœˆ / ä¹…å±‹å¤§é€š",
                        img: "https://www.aichi-now.jp/upload/spot_images/0599a0d84346087d1575807954930372.jpg",
                        desc: "åå¤å±‹æœ€ç¹è¯çš„å€åŸŸã€‚æœ‰è¨±å¤šç™¾è²¨å…¬å¸å¦‚æ¾å‚å±‹ã€PARCOï¼Œä»¥åŠåœ°æ¨™ RAYARD Hisaya-odori Parkï¼Œå…¬åœ’å…©å´å……æ»¿æ–‡é’åº—é‹ªï¼Œé©åˆæ‚ é–’æ•£æ­¥ã€‚",
                    }
                ]
            },
            {
                category: "ç¾é£Ÿæ”»ç•¥",
                color: "text-[#dca856]",
                items: [
                    {
                        title: "é°»é­šé£¯ä¸‰åƒ (Hitsumabushi)",
                        img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSq4Xn0z5x7x7x7x7x7x7x7x7x7x7x7x7x7&s",
                        desc: "åå¤å±‹å¿…åƒéˆé­‚ç¾é£Ÿã€‚ç¬¬ä¸€åƒå“åšåŸå‘³ï¼Œç¬¬äºŒåƒåŠ å…¥ä½æ–™ï¼ˆæµ·è‹”ã€è”¥èŠ±ã€èŠ¥æœ«ï¼‰ï¼Œç¬¬ä¸‰åƒåŠ å…¥é«˜æ¹¯åšæˆèŒ¶æ³¡é£¯ã€‚æ¨è–¦ååº—ï¼šè“¬èŠè»’ã€‚",
                    },
                    {
                        title: "ç‚¸è¦ / ç‚¸è±¬æ’",
                        img: "https://tblg.k-img.com/restaurant/images/Rvw/28848/640x640_rect_28848937.jpg",
                        desc: "åå¤å±‹äººè¶…æ„›ç‚¸ç‰©èˆ‡å‘³å™Œã€‚å·¨å¤§çš„ç‚¸è¦ï¼ˆæµ·è€ãƒ•ãƒ©ã‚¤ï¼‰å’Œæ·‹ä¸Šæ¿ƒåšç´…å‘³å™Œé†¬çš„å‘³å™Œè±¬æ’ï¼ˆçŸ¢å ´è±šï¼‰æ˜¯ç¶“å…¸ä»£è¡¨ï¼Œå£æ„Ÿé…¥è„†ï¼Œé†¬æ±æ¿ƒéƒã€‚",
                    },
                    {
                        title: "åå¤å±‹æ—©é¤æ–‡åŒ–",
                        img: "https://nagoya-meshi.jp/wp-content/uploads/2020/10/morning_kv.jpg",
                        desc: "ã€Œé»é£²æ–™é€æ—©é¤ã€æ˜¯é€™è£¡çš„ç‰¹æœ‰æ–‡åŒ–ã€‚é€šå¸¸é»ä¸€æ¯å’–å•¡å°±æœƒé™„è´ˆçƒ¤åå¸èˆ‡æ°´ç…®è›‹ï¼Œæ˜¯é–‹å•Ÿåå¤å±‹æ—©æ™¨æœ€é“åœ°çš„æ–¹å¼ã€‚",
                    }
                ]
            }
        ];
        
        const mediaData = [
            {
                type: "yt",
                title: "åå¤å±‹äº¤é€šæ”»ç•¥ï½œåéµ Î¼-SKY",
                desc: "æ©Ÿå ´åˆ°å¸‚å€åªè¦28åˆ†é˜ï¼è³¼ç¥¨æ•™å­¸èˆ‡æ­ä¹˜å¯¦æ¸¬ã€‚",
                url: "https://www.youtube.com/results?search_query=åå¤å±‹+æ©Ÿå ´+åéµ+æ”»ç•¥"
            },
            {
                type: "ig",
                title: "çŠ¬å±±åŸå’Œæœé«”é©— Reels",
                desc: "11PhotoStudio æ›è£éç¨‹ï¼Œé‚„æœ‰è¶…å¥½æ‹çš„åŸä¸‹ç”ºæ•£æ­¥æ™¯é»ï¼",
                url: "https://www.instagram.com/explore/tags/çŠ¬å±±åŸå’Œæœ/"
            },
            {
                type: "yt",
                title: "è“¬èŠè»’é°»é­šé£¯ æ’éšŠæ”»ç•¥",
                desc: "ä¸æƒ³æ’éšŠæ’åˆ°å¤©è’åœ°è€ï¼Ÿå¿…çœ‹çš„æŠ½æ•´ç†åˆ¸æŠ€å·§ã€‚",
                url: "https://www.youtube.com/results?search_query=è“¬èŠè»’+é°»é­šé£¯+æ”»ç•¥"
            },
            {
                type: "ig",
                title: "ç™½å·é„‰åˆæŒæ‘ çµ•ç¾æ‹ç…§é»",
                desc: "é›ªåœ°è£¡çš„ç«¥è©±ä¸–ç•Œï¼Œé€™å¹¾å€‹è§’åº¦æ‹èµ·ä¾†æœ€å¤¢å¹»ï¼",
                url: "https://www.instagram.com/explore/tags/ç™½å·é„‰åˆæŒæ‘/"
            },
            {
                type: "yt",
                title: "åå¤å±‹å¿…è²·ä¼´æ‰‹ç¦® Top 10",
                desc: "è¦ä»™è²ã€å°å€‰ç´…è±†åå¸å¤¾å¿ƒé¤…...ç…§è‘—è²·ä¸è¸©é›·ï¼",
                url: "https://www.youtube.com/results?search_query=åå¤å±‹+ä¼´æ‰‹ç¦®"
            }
        ];

        const defaultPackingList = [
            "è­·ç…§ (æœ‰æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", "eSIM / æ¼«éŠé–‹é€š", "æ—¥å¹£ (ç¾é‡‘)", "Visit Japan Webæˆªåœ–", 
            "è¡Œå‹•é›»æº & å……é›»ç·š", "å¸¸å‚™è—¥å“ (èƒƒè—¥/æ­¢ç—›)", "ç‰™åˆ·ç‰™è†", "ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)", 
            "ä¿æš–è¡£ç‰©", "èˆ’é©å¥½èµ°çš„é‹", "æš–æš–åŒ…", "å£ç½©", "è³¼ç‰©è¢‹ (ç’°ä¿è¢‹)"
        ];

        // --- é‚è¼¯å€ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderDateSelector();
            renderItinerary(0);
            renderGuide();
            renderMedia(); 
            renderChecklist();
        });

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + tabId).classList.add('active');
            window.scrollTo(0,0);
        }

        function renderDateSelector() {
            const container = document.getElementById('date-scroll');
            container.innerHTML = itineraryData.map((day, index) => `
                <button onclick="renderItinerary(${index})" id="date-btn-${index}" 
                    class="date-btn flex-shrink-0 px-4 py-2 rounded-2xl border border-gray-100 shadow-sm bg-white min-w-[70px] text-center transition-all ${index === 0 ? 'bg-[#5e8b7e] text-white ring-2 ring-[#5e8b7e]/50' : 'text-gray-500'}">
                    <div class="text-xs font-bold mb-1">${day.date}</div>
                    <div class="text-[10px] opacity-80">${day.day}</div>
                </button>
            `).join('');
        }

        // --- å¤©æ°£ API ä¸²æ¥é‚è¼¯ (Open-Meteo) ---
        async function fetchWeather(lat, lon, dateStr) {
            const container = document.getElementById('weather-card-container');
            // å…ˆé¡¯ç¤º Loading ç‹€æ…‹
            container.innerHTML = `
                <div class="watercolor-card p-4 bg-gradient-to-br from-[#fdfbf7] to-[#fff] border-l-4 border-[#769a9e] mb-4 mx-2 animate-pulse">
                    <div class="flex items-center gap-4">
                        <div class="text-center w-16 shrink-0 text-gray-300">
                            <i class="fas fa-circle-notch fa-spin text-2xl"></i>
                        </div>
                        <div class="flex-1 pl-4">
                            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                            <div class="h-3 bg-gray-100 rounded w-1/2"></div>
                        </div>
                    </div>
                </div>`;

            // è™•ç†æ—¥æœŸæ ¼å¼ (å°‡ "2/9" è½‰ç‚º "2026-02-09")
            const year = "2026";
            const [month, day] = dateStr.split('/');
            const formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
            
            try {
                // Open-Meteo API
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Asia%2FTokyo&start_date=${formattedDate}&end_date=${formattedDate}`;
                
                const response = await fetch(url);
                const data = await response.json();

                if (data.daily && data.daily.time.length > 0) {
                    const min = Math.round(data.daily.temperature_2m_min[0]);
                    const max = Math.round(data.daily.temperature_2m_max[0]);
                    const code = data.daily.weathercode[0];
                    let icon = "fa-sun";
                    let condition = "æ™´æœ—";
                    
                    // ç°¡å–®çš„å¤©æ°£ä»£ç¢¼è½‰æ›
                    if (code > 3) { icon = "fa-cloud"; condition = "å¤šé›²"; }
                    if (code > 45) { icon = "fa-smog"; condition = "éœ§"; }
                    if (code > 50) { icon = "fa-cloud-rain"; condition = "æœ‰é›¨"; }
                    if (code > 70) { icon = "fa-snowflake"; condition = "æœ‰é›ª"; }

                    return { min, max, icon, condition, isForecast: true };
                }
            } catch (e) {
                console.error("Weather fetch failed", e);
            }
            // è‹¥å¤±æ•—æˆ–ç„¡æ•¸æ“šï¼Œè¿”å›é è¨­å€¼ (ä¾ç…§äºŒæœˆå¹³å‡)
            return { min: 2, max: 9, icon: "fa-cloud-sun", condition: "å¹³å‡æ°£å€™", isForecast: false };
        }

        async function renderItinerary(index) {
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.date-btn').forEach(btn => {
                btn.classList.remove('bg-[#5e8b7e]', 'text-white', 'ring-2');
                btn.classList.add('text-gray-500', 'bg-white');
            });
            const activeBtn = document.getElementById(`date-btn-${index}`);
            activeBtn.classList.remove('text-gray-500', 'bg-white');
            activeBtn.classList.add('bg-[#5e8b7e]', 'text-white', 'ring-2', 'ring-[#5e8b7e]/50');

            const dayData = itineraryData[index];
            
            // 1. å–å¾—å¤©æ°£è³‡è¨Š
            // æ‰¾å‡ºè©²æ—¥æœŸçš„åœ°é»åº§æ¨™ï¼Œè‹¥ç„¡å‰‡é è¨­åå¤å±‹
            const locKey = dayData.locationKey || "Nagoya";
            const coords = locationCoords[locKey];
            
            // å‘¼å« API (éåŒæ­¥)
            const weather = await fetchWeather(coords.lat, coords.lon, dayData.date);

            // æ¸²æŸ“å¤©æ°£å¡ç‰‡
            const weatherContainer = document.getElementById('weather-card-container');
            const weatherBadge = weather.isForecast ? '<span class="bg-blue-100 text-blue-600 text-[10px] px-1 rounded ml-1">é å ±</span>' : '<span class="bg-gray-100 text-gray-500 text-[10px] px-1 rounded ml-1">æ­·å²å¹³å‡</span>';
            
            const weatherHtml = `
                <div class="watercolor-card p-4 bg-gradient-to-br from-[#fdfbf7] to-[#fff] border-l-4 border-[#769a9e] mb-4 mx-2">
                    <div class="flex items-center gap-4">
                        <div class="text-center w-16 shrink-0 text-[#769a9e]">
                            <i class="fas ${weather.icon} text-2xl mb-1"></i>
                            <div class="font-bold text-sm text-nowrap">${weather.min}Â°-${weather.max}Â°</div>
                        </div>
                        <div class="flex-1 border-l border-gray-100 pl-4">
                            <div class="flex items-center mb-1">
                                <span class="text-xs text-gray-500 tracking-wider font-bold mr-1">${locKey === 'Shirakawa' ? 'ç™½å·é„‰' : (locKey === 'Takayama' ? 'é«˜å±±' : 'åå¤å±‹')}</span>
                                <span class="text-xs text-gray-400">${weather.condition}</span>
                                ${weatherBadge}
                            </div>
                            <div class="text-sm text-gray-600 font-medium leading-relaxed">
                                <i class="fas fa-tshirt text-[#e6a496] mr-1"></i>
                                ${dayData.outfit}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            weatherContainer.innerHTML = weatherHtml;

            // 2. æ¸²æŸ“æ™‚é–“è»¸
            const container = document.getElementById('itinerary-container');
            let html = `<div class="pl-8 mb-6"><div class="inline-block bg-[#e08e79]/10 text-[#e08e79] px-3 py-1 rounded-full text-xs font-bold border border-[#e08e79]/20"><i class="fas fa-bed mr-1"></i> ${dayData.hotel}</div></div>`;

            html += dayData.events.map((event, evtIndex) => {
                const isImportant = event.important ? 'border-l-4 border-[#dca856] bg-[#fffcf5]' : 'border-l-4 border-transparent bg-white';
                const timeColor = event.important ? 'text-[#dca856]' : 'text-[#769a9e]';
                
                // ä¿®æ”¹ï¼šé»æ“Šäº‹ä»¶è§¸ç™¼ Modal
                return `
                <div class="relative pl-8 pb-1 group" onclick="openEventModal(${index}, ${evtIndex})">
                    <div class="absolute left-0 top-1 w-8 flex flex-col items-center z-10">
                        <div class="w-3 h-3 rounded-full bg-white border-2 border-[#5e8b7e] group-hover:scale-125 transition-transform"></div>
                    </div>
                    <div class="watercolor-card p-4 mb-4 ${isImportant} hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-1">
                            <span class="font-mono text-sm font-bold ${timeColor}">${event.time} - ${event.end}</span>
                            <i class="fas ${event.icon} text-gray-300 text-sm"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-1 leading-tight">${event.title}</h3>
                        ${event.desc ? `<p class="text-sm text-gray-500 mb-2 leading-relaxed line-clamp-2">${event.desc}</p>` : ''}
                        
                        <div class="flex justify-end mt-2">
                             <span class="text-xs text-[#769a9e] bg-[#769a9e]/10 px-2 py-1 rounded-full"><i class="fas fa-search-plus mr-1"></i>æ”»ç•¥</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
            container.innerHTML = html;
        }

        // --- å½ˆçª—ç›¸é—œé‚è¼¯ ---
        function openEventModal(dayIndex, eventIndex) {
            const event = itineraryData[dayIndex].events[eventIndex];
            
            document.getElementById('modal-title').innerText = event.title;
            document.getElementById('modal-time').innerText = `${event.time} - ${event.end}`;
            document.getElementById('modal-desc').innerText = event.guide || "æš«ç„¡ç‰¹åˆ¥æ”»ç•¥ï¼Œè«‹äº«å—æ—…ç¨‹ï¼";
            
            // è™•ç†æ¨™ç±¤
            const tagsContainer = document.getElementById('modal-tags');
            tagsContainer.innerHTML = '';
            if (event.tags) {
                event.tags.forEach(tag => {
                    const span = document.createElement('span');
                    span.className = `guide-tag tag-${tag.type}`;
                    span.innerText = tag.text;
                    tagsContainer.appendChild(span);
                });
            }

            // è™•ç†åœ°åœ–é€£çµ
            const mapBtn = document.getElementById('modal-map-btn');
            if (event.location) {
                mapBtn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.location)}`;
                mapBtn.style.display = 'flex';
            } else {
                mapBtn.style.display = 'none';
            }

            document.getElementById('event-modal').classList.add('open');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
        }

        function closeModal() {
            document.getElementById('event-modal').classList.remove('open');
            document.body.style.overflow = '';
        }

        function renderGuide() {
            const container = document.getElementById('guide-container');
            container.innerHTML = guideData.map(group => {
                const itemsHtml = group.items.map(spot => `
                    <div class="watercolor-card overflow-hidden bg-white mb-6">
                        <div class="h-40 overflow-hidden relative">
                            <img src="${spot.img}" alt="${spot.title}" class="w-full h-full object-cover">
                            <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/60 to-transparent p-3 pt-8">
                                <h3 class="text-white text-lg font-bold tracking-widest">${spot.title}</h3>
                            </div>
                        </div>
                        <div class="p-4">
                            <p class="text-gray-600 text-sm leading-6 text-justify font-light">
                                <span class="text-3xl float-left mr-2 mt-[-5px] handwriting text-[#e08e79]">${spot.desc.charAt(0)}</span>${spot.desc.slice(1)}
                            </p>
                        </div>
                    </div>
                `).join('');

                return `
                    <div class="mb-8">
                        <h3 class="text-xl handwriting mb-4 ${group.color} border-b border-gray-200 pb-2">
                            <i class="fas fa-map-pin mr-2 text-sm"></i>${group.category}
                        </h3>
                        <div class="space-y-4">
                            ${itemsHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderMedia() {
            const container = document.getElementById('media-container');
            container.innerHTML = mediaData.map(item => {
                const iconClass = item.type === 'yt' ? 'fa-youtube yt-icon' : 'fa-instagram ig-icon';
                const iconBg = item.type === 'yt' ? 'bg-red-50' : 'bg-pink-50';
                const btnText = item.type === 'yt' ? 'è§€çœ‹å½±ç‰‡' : 'æŸ¥çœ‹ IG';
                
                return `
                <a href="${item.url}" target="_blank" class="block watercolor-card p-4 transition-transform active:scale-95">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-full ${iconBg} flex items-center justify-center shrink-0">
                            <i class="fab ${iconClass} text-2xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-800 mb-1">${item.title}</h3>
                            <p class="text-xs text-gray-500 mb-3 leading-relaxed">${item.desc}</p>
                            <span class="inline-block text-xs font-bold text-[#769a9e] bg-[#769a9e]/10 px-3 py-1 rounded-full">
                                <i class="fas fa-play mr-1 text-[10px]"></i> ${btnText}
                            </span>
                        </div>
                        <div class="flex flex-col justify-center h-full text-gray-300">
                             <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </a>
                `;
            }).join('');
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            const savedState = JSON.parse(localStorage.getItem('trip_checklist_state')) || {};
            
            container.innerHTML = defaultPackingList.map((item, index) => {
                const isChecked = savedState[item] ? 'checked' : '';
                return `
                <div class="flex items-center gap-3 p-2 border-b border-gray-50 last:border-0 hover:bg-gray-50 rounded-lg transition-colors">
                    <input type="checkbox" id="check-${index}" class="custom-checkbox hidden" ${isChecked} onchange="toggleCheck('${item}')">
                    <label for="check-${index}" class="text-sm text-gray-700 flex-1 cursor-pointer select-none">${item}</label>
                </div>`;
            }).join('');
        }

        function toggleCheck(item) {
            const savedState = JSON.parse(localStorage.getItem('trip_checklist_state')) || {};
            if (savedState[item]) {
                delete savedState[item];
            } else {
                savedState[item] = true;
            }
            localStorage.setItem('trip_checklist_state', JSON.stringify(savedState));
            renderChecklist();
        }
    </script>
</body>
</html>
